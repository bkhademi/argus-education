!function(){angular.module("inspinia",["ui.router","oc.lazyLoad","ui.bootstrap","ngResource","satellizer","ngStorage"]),angular.module("Argus",["inspinia"]).config(["$stateProvider","$urlRouterProvider","$ocLazyLoadProvider","$authProvider","$httpProvider","$provide",function(e,t,o,r,n,a){var s=function(e,t){return{responseError:function(o){var r=t.get("$state"),n=["token_not_provided","token_expired","token_absent","token_invalid","user_not_found"];return angular.forEach(n,function(e,t){o.data.error===e&&(localStorage.removeItem("user"),r.go("auth"))}),e.reject(o)}}};a.factory("redirectWhenLoggedOut",s),n.interceptors.push("redirectWhenLoggedOut"),r.loginUrl="/api/authenticate",t.otherwise("/auth"),e.state("auth",{url:"/auth",templateUrl:"views/login.html",controller:"AuthController as auth",data:{pageTitle:"Login",specialClass:"white-bg"}}),o.config({debug:!1})}]).run(function(e,t){e.$on("$stateChangeStart",function(t,o){var r=JSON.parse(localStorage.getItem("user"));r&&(e.authenticated=!0,e.currentUser=r,"auth"===o.name)}),e.$state=t}).controller("AuthController",function(e,t,o,r){var n=this;n.loginError=!1,n.loginErrorText,n.login=function(){var a={email:n.email,password:n.password};e.login(a).then(function(e){return o.get("api/authenticate/user").then(function(e){var o=JSON.stringify(e.data.user);localStorage.setItem("user",o),r.authenticated=!0,r.currentUser=e.data.user;var n="";switch(e.data.user.role){case"Lead GTM Coordinator":n="admin1";break;case"AEC Coordinator":n="admin2";break;case"O-Room Coordinator":n="admin3";break;case"Student":n="student";break;case"Teacher":n="teacher";break;case"Supporting Staff":return n="supportstaff",void t.go("supportstaff.oroomActivitiLog");case"ISS Coordinator":return void t.go("iss.Lists.iss");case"Data Staff":return void t.go("datastaff.reports.eod");case"System Admin":return void t.go("sysadmin.dashboard");case"Reteach Coordinator":return void t.go("reteach.dashboard");case"ASP Coordinator":return void t.go(e.data.user.route);default:console.log("unknown role")}t.go(n+".dashboard")})},function(e){n.loginError=!0,n.loginErrorText=e.data.error})}}).controller("MainCtrl",["$rootScope","$auth","$state",function(e,t,o){var r=JSON.parse(localStorage.getItem("user"));e.currentUser=r,e.currentUser||JSON.parse(localStorage.getItem("user"))?this.userName=e.currentUser.FirstName+", "+e.currentUser.LastName:this.userName="Please Log In",this.logout=function(){t.logout().then(function(){localStorage.removeItem("user"),e.authenticated=!1,e.currentUser=null,o.go("auth")})}}]).controller("TopNavCtrl",["StudentsService","$modal","$scope","$rootScope",function(e,t,o,r){var n=this;n.schoolStudents=e.students,n.openCreateNewStudent=function(){var o={UserInfo:{},StuInfo:{},ProfessorClasses:[]},a=t.open({templateUrl:"views/modals/CreateStudentModal.html",size:"lg",controller:function(e,t,o){e.schools=[{Id:1,Name:"Estacado High School"},{Id:2,Name:"Dunbar College Preparatory Academy"},{Id:3,Name:"Ervin Elementary School"},{Id:4,Name:"Adrian School"}],e.classes=o.query(),e.student=t},resolve:{student:function(){return o}}});a.result.then(function(){o.StuInfo.StudentId=o.UserInfo.UserName,o.UserInfo.SchoolId=o.UserInfo.SchoolId.Id,angular.forEach(o.ProfessorClasses,function(e){console.log(e),e.ProfessorClassId=e.ProfessorClass.Id,delete e.ProfessorClass}),o.userInfo=o.UserInfo,e.save(o,function(t){e.query({admin:!0,light:!0},function(t){n.schoolStudents=t,e.students=t,r.$broadcast("studentsUpdated",{students:t})})})},function(){})},n.selectedStudent=function(){var o=n.student,r=e.get({id:o.Id},function(e){var a=t.open({templateUrl:"views/modals/ProfileModal.html",size:"lg",controller:function(e,t,o){e.periods=o.query(),e.student=t},resolve:{student:function(){return r}}});a.result.then(function(){$model=null},function(){console.log("dismissed"),$label=null,$model=null,o=null,n.student=null})})}}])}();var api="/api/";